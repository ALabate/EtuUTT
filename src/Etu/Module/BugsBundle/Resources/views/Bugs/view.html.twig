{% extends '::page-2cols.html.twig' %}

{% block title %}{{ 'bugs.view.page.title'|trans }}{% endblock %}

{% block titleIcon %}
	<img src="{{ asset('img/titles/bugs.png') }}" alt="{{ 'base.logo.alt'|trans }}" title="{{ 'base.logo.title'|trans }}" class="page-title-icon" />
{% endblock %}

{% block content %}
	<ul class="nav nav-tabs page-tabs">
		<li>
			<a href="{{ path('bugs_index') }}">{{ 'bugs.index.page.opened'|trans }}</a>
		</li>
		<li>
			<a href="{{ path('bugs_closed') }}">{{ 'bugs.index.page.resolved'|trans }}</a>
		</li>
		<li class="pull-right">
			<a href="{{ path('bugs_create') }}">
				<i class="icon-plus"></i>
				{{ 'bugs.index.page.create'|trans }}
			</a>
		</li>
	</ul>

	{{ etu_subscribe.block('issue', bug.id) }}

	<div class="padding20-sides">

		<h3>
			{{ bug.title }}

			{% if bug.criticality == 'security' %}
				<span class="label label-important">
					{{ ('bugs.criticality.'~bug.criticality)|trans }}
				</span>
			{% elseif bug.criticality == 'critical' or bug.criticality == 'major' %}
				<span class="label label-warning">
					{{ ('bugs.criticality.'~bug.criticality)|trans }}
				</span>
			{% elseif bug.criticality == 'minor' %}
				<span class="label label-info">
					{{ ('bugs.criticality.'~bug.criticality)|trans }}
				</span>
			{% else %}
				<span class="label">
					{{ ('bugs.criticality.'~bug.criticality)|trans }}
				</span>
			{% endif %}
		</h3>



		<hr />

		{% if bug.assignee %}
			<div class="alert alert-info">
				{{ 'bugs.view.page.assigned_to'|trans({'%name%': bug.assignee.login}) }}
			</div>

			<hr />
		{% endif %}

		<div class="etu-comment">
			<div class="etu-comment-avatar">
				<img src="{{ asset('photos/'~bug.user.avatar) }}" />
			</div>
			<div class="etu-comment-infos">
				<div class="etu-comment-date">
					<small>
						#1 - {{ bug.user.login }}
					</small>
					<small class="pull-right">{{ time_diff(bug.createdAt)|ucfirst }}</small>
				</div>
				<div class="etu-comment-body">
					{{ bug.body|raw }}
				</div>
			</div>

			<div class="clear"></div>
		</div>

		{% for key, comment in comments %}
			<div class="etu-comment">
				<div class="etu-comment-avatar">
					<img src="{{ asset('photos/'~comment.user.avatar) }}" />
				</div>
				<div class="etu-comment-infos">
					<div class="etu-comment-date">
						<small>
							#{{ key+2 }} - {{ comment.user.login }}
						</small>
						<small class="pull-right">{{ time_diff(comment.createdAt)|ucfirst }}</small>
					</div>
					<div class="etu-comment-body">
						{{ comment.body|raw }}
					</div>
				</div>

				<div class="clear"></div>
			</div>
		{% endfor %}


		<div class="bugs-view-comment">
			<h4>{{ 'bugs.view.comment.comment'|trans }}</h4>

			<form method="post">
				<div class="control-group">
					<div class="hidden">{{ form_label(form.body, 'bugs.view.comment.body'|trans) }}</div>
					<div>{{ form_widget(form.body, {'attr': {'class': 'bugs-view-comment-textarea redactor'}}) }}</div>
				</div>
				<div class="control-group">
					{{ form_rest(form) }}
					<input type="submit" class="btn pull-right" value="{{ 'bugs.view.comment.comment'|trans }}" />
				</div>
			</form>
		</div>

		{% if app.user.hasPermission('bugs.admin') %}
		<div class="bugs-view-comment hidden-for-phones">
			<h4>{{ 'bugs.view.admin.title'|trans }}</h4>

			<hr />

			<div class="row-fluid">
				<div class="span6">
					<h5>{{ 'bugs.view.admin.assigne'|trans }}</h5>

					<form method="post" action="" class="form-inline">
						<input type="text" placeholder="{{ 'bugs.view.admin.assigne_placeholder'|trans }}" />
						<button type="submit" class="btn">{{ 'bugs.view.admin.assigne'|trans }}</button>
					</form>
				</div>
				<div class="span6">
					<h5>{{ 'bugs.view.admin.edit_criticality'|trans }}</h5>

					<form method="post" action="" class="form-inline">
						{{ form_widget(updateForm.criticality) }}
						<button type="submit" class="btn">{{ 'bugs.view.admin.edit'|trans }}</button>
					</form>
				</div>
			</div>

			<div class="row-fluid">
				<div class="span6">
					<h5>{{ 'bugs.view.admin.fix_with_commit'|trans }}</h5>

					<form method="post" action="" class="form-inline">
						<input type="text" placeholder="{{ 'bugs.view.admin.fix_with_commit_placeholder'|trans }}" />
						<button type="submit" class="btn">{{ 'bugs.view.admin.fix'|trans }}</button>
					</form>
				</div>
				<div class="span6">
					<h5>{{ 'bugs.view.admin.fix_without_commit'|trans }}</h5>

					<form method="post" action="" class="form-inline">
						<button type="submit" class="btn">{{ 'bugs.view.admin.fix'|trans }}</button>
					</form>
				</div>
			</div>
		</div>
		{% endif %}

	</div>
{% endblock %}