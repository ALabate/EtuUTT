{% extends '::page-2cols.html.twig' %}

{% block title %}{{ membership.organization.name }}{% endblock %}

{% block titleIcon %}
	<img src="{{ asset('img/titles/orga.png') }}" alt="{{ 'base.logo.alt'|trans }}" title="{{ 'base.logo.title'|trans }}" class="page-title-icon" />
{% endblock %}

{% block content %}
	<div class="padding20-all">
		<div class="row-fluid">
			<div class="span3 memberships">
				<ul class="nav nav-list">
					{% for m in memberships %}
						<li{% if membership.id == m.id %} class="active"{% endif %}>
							<a href="{{ path('memberships_orga', {'login': m.organization.login}) }}">
								{{ m.organization.name }}<br />
								{% if membership.id == m.id %}
									{{ ('user.orga.role.'~m.role)|trans }}
								{% else %}
									<span class="muted">{{ ('user.orga.role.'~m.role)|trans }}</span>
								{% endif %}
							</a>
						</li>
					{% endfor %}
				</ul>
			</div>

			<div class="span9">
				<ul class="nav nav-tabs">
					<li>
						<a href="{{ path('memberships_orga', {'login': membership.organization.login}) }}">
							{{ 'user.memberships.menu.position'|trans }}
						</a>
					</li>
					{% if membership.hasPermission('edit_desc') %}
						<li>
							<a href="{{ path('memberships_orga_desc', {'login': membership.organization.login}) }}">
								{{ 'user.memberships.menu.orga'|trans }}
							</a>
						</li>
					{% endif %}

					{% if membership.hasPermission('deleguate') %}
						<li>
							<a href="{{ path('memberships_orga_permissions', {'login': membership.organization.login}) }}">
								{{ 'user.memberships.menu.permissions'|trans }}
							</a>
						</li>
					{% endif %}

					{% if membership.hasPermission('notify') %}
						<li>
							<a href="{{ path('memberships_orga_notifications', {'login': membership.organization.login}) }}">
								{{ 'user.memberships.menu.notifications'|trans }}
							</a>
						</li>
					{% endif %}

					{% if membership.hasPermission('events') %}
						<li class="active">
							<a href="{{ path('memberships_orga_events', {'login': membership.organization.login}) }}">
								{{ 'user.memberships.menu.event'|trans }}
							</a>
						</li>
					{% endif %}

					{% if membership.hasPermission('daymail') %}
						<li>
							<a href="{{ path('memberships_orga_daymail', {'login': membership.organization.login}) }}">
								{{ 'user.memberships.menu.daymail'|trans }}
							</a>
						</li>
					{% endif %}
				</ul>

				<p class="align-right">
					<a href="{{ path('memberships_orga_events_create', {'login': orga.login}) }}" class="btn btn-primary">
						{{ 'events.memberships.events.create'|trans }}
					</a>
				</p>

				{% set events = calendr_events(month) %}

				<div class="chooser row-fluid">
					<div class="span1">
						<a href="{{ path('memberships_orga_events', {'login': orga.login, 'month': previous|date('m-Y')}) }}" class="btn pull-left"> << </a>
					</div>
					<div class="span2"></div>
					<div class="span6 chooser-current">
						<div class="btn-group">
							<a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
								{{ ('events.main.months.'~month.begin.format('M')|lower)|trans }} {{ month.begin.format('Y') }}
								<span class="caret"></span>
							</a>
							<ul class="dropdown-menu">
								{% for m in monthsList %}
									<li>
										<a href="{{ path('memberships_orga_events', {'login': orga.login, 'month': m|date('m-Y')}) }}">
											{{ ('events.main.months.'~m.format('M')|lower)|trans }}
											{{ m.format('Y') }}
										</a>
									</li>
								{% endfor %}
							</ul>
						</div>
					</div>
					<div class="span3 chooser-type">
						<div class="btn-group">
							<a href="{{ path('memberships_orga_events', {'login': orga.login, 'month': next|date('m-Y')}) }}" class="btn"> >> </a>
						</div>
					</div>
				</div>

				<br />

				<table class="table table-bordered table-hover events-table events-table-month">
					<tr>
						<th>{{ 'events.main.days.mon'|trans }}</th>
						<th>{{ 'events.main.days.tue'|trans }}</th>
						<th>{{ 'events.main.days.wed'|trans }}</th>
						<th>{{ 'events.main.days.thu'|trans }}</th>
						<th>{{ 'events.main.days.fri'|trans }}</th>
						<th>{{ 'events.main.days.sat'|trans }}</th>
						<th>{{ 'events.main.days.sun'|trans }}</th>
					</tr>

					{% for week in month %}
						<tr>
							{% for day in week %}
								<td>
									{% if month.contains(day.begin) %}
										<div class="event-day">{{ day.begin.format('d') }}</div>

										<div class="clear"></div>

										{% for event in events.find(day) %}
											{% if event.orga.id == orga.id %}
												<a href="{{ path('memberships_orga_events_edit', {
													'login': orga.login,
													'id': event.id,
													'slug': event.title|slugify
												}) }}"
												   class="event event-{{ event.category }} tip"
												   title="<strong>{{ event.title }}</strong><br />
										   {{ 'events.main.index.organised_by'|trans({'%orga%': event.orga.name}) }}"></a>
											{% endif %}
										{% endfor %}
									{% else %}
										&nbsp;
									{% endif %}
								</td>
							{% endfor %}
						</tr>
					{% endfor %}

				</table>
			</div>
		</div>
	</div>
{% endblock %}