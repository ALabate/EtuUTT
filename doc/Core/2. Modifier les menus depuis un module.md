Modifier les menus depuis un module
===================================

Le système de modules se voulant le plus découplé possible, il existe un
système externalisé pour modifier les menus depuis un module.

La classe de module
-------------------

Avant tout, vous devez savoir quelques petites choses pour bien comprendre
la suite.

Dans le code, un module est caractérisé par une classe qui le décrit auprès
du CoreBundle. Par exemple, le module de bugs possède la classe de module
suivante :

	<?php

	namespace Etu\Module\BugsBundle;

	use Etu\Core\CoreBundle\Framework\Definition\Module;

	class EtuModuleBugsBundle extends Module
	{
		/**
		 * Module identifier (to be required by other modules)
		 *
		 * @return string
		 */
		public function getIdentifier()
		{
			return 'bugs';
		}

		/**
		 * Module title (describe shortly its aim)
		 *
		 * @return string
		 */
		public function getTitle()
		{
			return 'Bugs';
		}

		/**
		 * Module author
		 *
		 * @return string
		 */
		public function getAuthor()
		{
			return 'Titouan Galopin';
		}

		/**
		 * Module description
		 *
		 * @return string
		 */
		public function getDescription()
		{
			return 'Gestion des bugs et des suggestions';
		}

		/**
		 * @return string
		 */
		public function getAvailablePermissions()
		{
			return array(
				'bugs.admin' => 'Administrer les bugs',
				'suggests.admin' => 'Administrer les suggestions',
			);
		}

		/**
		 * Define the modules requirements (the other required modules) using their identifiers
		 *
		 * @return array
		 */
		public function getRequirements()
		{
			return array(
				// Insert your requirements here
			);
		}
		/**
		 * @return bool|void
		 */
		public function mustBoot()
		{
			// ...
		}

		/**
		 * At module boot
		 */
		public function onModuleBoot()
		{
			// ...
		}
	}

Comme vous pouvez le voir, il existe de nombreuses méthodes permettant
d'interagir avec le coeur :

	- `getIdentifier()` : l'identifiant du module
	- `getTitle()` : le nom, le titre du module
	- `getAuthor()` : le nom de l'auteur du module (par défaut à 'anonymous')
	- `getDecription()` : une brève description du module
	- `getAvailablePermissions()` : la liste de permissions créées par le module
			(pour l'affectation à des utilisateurs dans l'interface d'aministration)
	- `getRequirements()` : la liste des identifiants de modules nécessaire au fonctionnement de ce module
			(pour éviter les erreurs en interdisant la désactivation de certains modules nécessaires)
	- `mustBoot()` : condition selon laquelle le module doit être chargé ou non
	- `onModuleBoot` : action à exécuter au moment du chargement du module

Modifier les menus
------------------

Afin de modifier les menus, il faut donc exécuter une action au moment du chargement du module, pour
que les menus soient affichés sur chaque page.

Pour cela, utilisons `onModuleBoot` :

	<?php
    namespace Etu\Module\BugsBundle;
    use Etu\Core\CoreBundle\Framework\Definition\Module;

    class EtuModuleBugsBundle extends Module
    {
        // ...

        /**
         * At module boot
         */
        public function onModuleBoot()
        {
			// Actions à réaliser
        }
    }

Les menus sont modifiables en utilisant les méthodes internes `$this->getUserMenuBuilder()`
et `$this->getSidebarBuilder()`:

	<?php
    namespace Etu\Module\BugsBundle;
    use Etu\Core\CoreBundle\Framework\Definition\Module;

    class EtuModuleBugsBundle extends Module
    {
        // ...

        /**
         * At module boot
         */
        public function onModuleBoot()
        {
			$this->getSidebarBuilder()
				->getBlock('base.sidebar.etu.title')
					->add('bugs.sidebar.items.suggest')
						->setIcon('etu-icon-comment')
						->setUrl($this->getRouter()->generate('bugs_suggestions'))
					->end()
					->add('bugs.sidebar.items.bugs')
						->setIcon('etu-icon-warning')
						->setUrl($this->getRouter()->generate('bugs_index'))
					->end();
        }
    }

Le code est assez clair de lui-même : il existe un système de blocs dans la sidebar (et non pas dans le UserMenu),
on modifie celui des services. `add()` permet d'ajouter un item, qui est personnalisé grâce à `setIcon()` et
`setUrl()`. `end()` indique la fin de la modification d'un item (retour au bloc) ou d'un bloc (retour au builder).